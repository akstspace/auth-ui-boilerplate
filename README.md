# Auth UI Boilerplate

Next.js + **Better Auth** + **Drizzle ORM** + **JWT/JWKS** backend integration. Includes Google OAuth, email/password auth, API proxy with automatic JWT injection, and integration guides for Go, Python, and Express.

## Quick Start (Dev Container)

> Requires [VS Code](https://code.visualstudio.com/) + [Dev Containers extension](https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.remote-containers) + Docker.

1. **Open in Dev Container** â€” Open this repo in VS Code, then `Cmd+Shift+P` â†’ "Dev Containers: Reopen in Container". This spins up an Ubuntu container with Node.js (Volta) and a PostgreSQL 18 instance automatically.

2. **Install prerequisites** â€” Inside the container, run:
   ```bash
   volta install node
   pyenv install 3.12
   pyenv global 3.12
   ```

3. **Configure env** â€” Copy and edit the example env file:
   ```bash
   cp .env.example .env
   ```
   Update `GOOGLE_CLIENT_ID` and `GOOGLE_CLIENT_SECRET` with your [Google Cloud OAuth credentials](https://console.cloud.google.com/apis/credentials). Set the redirect URI to `http://localhost:3000/api/auth/callback/google`.

4. **Install & run**:
   ```bash
   npm install
   npm run db:push    # Push schema to Postgres
   npm run dev        # Start dev server on :3000
   ```

## Manual Setup (No Dev Container)

1. Have **Node.js 22+** and **PostgreSQL** running locally.
2. `cp .env.example .env` â€” update `DATABASE_URL` to point to your local Postgres.
3. `npm install && npm run db:push && npm run dev`

## Environment Variables

See [`.env.example`](.env.example) for all required variables:

| Variable | Scope | Purpose |
|---|---|---|
| `DATABASE_URL` | Server | PostgreSQL connection string |
| `BETTER_AUTH_URL` | Server | Auth server URL |
| `NEXT_PUBLIC_BETTER_AUTH_URL` | Client | Auth client URL |
| `GOOGLE_CLIENT_ID` | Server | Google OAuth client ID |
| `GOOGLE_CLIENT_SECRET` | Server | Google OAuth client secret |
| `BACKEND_API_URL` | Server | Backend URL (for API proxy) |
| `NEXT_PUBLIC_BACKEND_API_URL` | Client | Backend URL (for browser clients) |

## Backend Integration

This boilerplate issues **JWTs verified via JWKS** â€” no shared secrets needed. Your backend fetches public keys from:

```
{BETTER_AUTH_URL}/api/auth/jwks
```

The home page includes a built-in **integration guide** with complete Go, Python, and Express examples.

The API proxy at `src/app/api/[...path]/route.ts` automatically injects JWT bearer tokens into requests forwarded to `BACKEND_API_URL`.

## Database (Drizzle ORM)

This project uses [Drizzle ORM](https://orm.drizzle.team/) with PostgreSQL. The schema is defined in `src/db/schema.ts` and includes tables auto-generated by Better Auth: `user`, `session`, `account`, `verification`, and `jwks`.

### Commands

| Command | Description |
|---|---|
| `npm run db:push` | Push schema directly to DB (dev â€” no migration files) |
| `npm run db:generate` | Generate SQL migration files from schema changes |
| `npm run db:migrate` | Run pending migrations against the database |
| `npm run db:studio` | Open Drizzle Studio (visual DB browser) |

### Adding tables

1. Define your table in `src/db/schema.ts`:
   ```ts
   import { pgTable, text, timestamp } from "drizzle-orm/pg-core";

   export const post = pgTable("post", {
     id: text("id").primaryKey(),
     title: text("title").notNull(),
     userId: text("user_id").notNull().references(() => user.id, { onDelete: "cascade" }),
     createdAt: timestamp("created_at").$defaultFn(() => new Date()).notNull(),
   });
   ```
2. Push or migrate:
   ```bash
   npm run db:push       # Quick dev push (no migration files)
   # OR
   npm run db:generate   # Generate migration, then:
   npm run db:migrate    # Apply it
   ```
3. Query with Drizzle:
   ```ts
   import { db } from "@/db";
   import { post } from "@/db/schema";

   const posts = await db.select().from(post);
   ```

Config is in `drizzle.config.ts` â€” it reads `DATABASE_URL` from your env and outputs migrations to `src/db/migrations/`.

## Project Structure

```
src/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ api/auth/[...all]/   # Better Auth handler
â”‚   â”œâ”€â”€ api/[...path]/       # JWT-injecting API proxy
â”‚   â”œâ”€â”€ login/ & signup/     # Auth pages
â”‚   â””â”€â”€ page.tsx             # Home
â”œâ”€â”€ components/              # Auth status, API test, shadcn/ui
â”œâ”€â”€ lib/                     # Auth config, API clients (fetch & axios)
â””â”€â”€ db/                      # Drizzle schema & migrations
```

## Customize with AI

After cloning, give this prompt to your AI coding assistant (Cursor, Copilot, Claude Code, etc.) to strip the demo components and set up your app:

<details>
<summary>ðŸ“‹ Click to expand the prompt</summary>

```
I cloned the auth-ui-boilerplate. Strip all demo/boilerplate UI and turn this into a clean starting point for my app. Specifically:

1. **Remove demo components:**
   - Delete `src/components/auth-status.tsx` (auth status card)
   - Delete `src/components/api-test.tsx` and `src/components/api-test-axios.tsx` (API test cards)

2. **Replace the homepage (`src/app/page.tsx`):**
   - Remove all demo content (How It Works, Backend Integration guide, Security Best Practices, Environment Variables, Project Structure, Credits sections)
   - Keep the nav bar with the app name, GitHub link, and theme toggle
   - Keep the footer
   - Add a simple welcome/dashboard layout that shows the authenticated user's name and a sign-out button (use `authClient.useSession()` from `@/lib/auth-client`)

3. **Keep these files as-is (core infrastructure):**
   - `src/lib/auth.ts` and `src/lib/auth-client.ts` (Better Auth config)
   - `src/lib/api-client.ts` and `src/lib/api-client-axios.ts` (API clients with JWT injection)
   - `src/app/api/auth/[...all]/route.ts` (auth API handler)
   - `src/app/api/[...path]/route.ts` (JWT-injecting API proxy)
   - `src/app/login/page.tsx` and `src/app/signup/page.tsx` (auth pages)
   - `src/db/` (Drizzle schema and migrations)
   - `src/components/ui/` (shadcn/ui primitives)
   - `src/components/theme-provider.tsx` and `src/components/theme-toggle.tsx`
   - `src/components/fade-in.tsx`

4. **Update the app name:**
   - Ask me what my app name is before making any changes
   - Then replace "Auth UI Boilerplate" with my app name in the nav, footer, and `src/app/layout.tsx` metadata

5. **Clean up unused imports** after removing components.

The result should compile with `npm run build` and show a minimal authenticated dashboard.
```

</details>

## Credits

- [dreamsofcode-io/authly](https://github.com/dreamsofcode-io/authly) â€” Initial set of code, from which this project was updated and extended.

## License

MIT
